# Sliding Window Visual Explanation

## 🎨 **Visual Diagram**

### **Full Dataset (100,000 rows)**
```
┌─────────────────────────────────────────────────────────────────────┐
│ Row 0                                                               │
│ Row 1                                                               │
│ Row 2                                                               │
│ ...                                                                 │
│ Row 99,997                                                          │
│ Row 99,998                                                          │
│ Row 99,999                                                          │
└─────────────────────────────────────────────────────────────────────┘
                    100,000 rows total
```

---

### **Sliding Window (1,000 rows in memory)**

```
Full Dataset:
┌─────────────────────────────────────────────────────────────────────┐
│ Row 0                                                               │
│ Row 1                                                               │
│ ...                                                                 │
│ Row 2,999                                                           │
├═════════════════════════════════════════════════════════════════════┤ ← windowOffset = 3,000
│ Row 3,000  ◄─────────────────────────────────────────────┐         │
│ Row 3,001                                                 │         │
│ Row 3,002                                                 │         │
│ ...                                                       │         │
│ Row 3,997                                                 │         │
│ Row 3,998                                                 │         │
│ Row 3,999  ◄─────────────────────────────────────────────┘         │
├─────────────────────────────────────────────────────────────────────┤
│ Row 4,000                                                           │
│ Row 4,001                                                           │
│ ...                                                                 │
│ Row 99,999                                                          │
└─────────────────────────────────────────────────────────────────────┘

                    ↓ Only this section in memory ↓

In-Memory Window (patients array):
┌─────────────────────────────────────────────────────────────────────┐
│ Row 3,000                                                           │
│ Row 3,001                                                           │
│ Row 3,002                                                           │
│ ...                                                                 │
│ Row 3,997                                                           │
│ Row 3,998                                                           │
│ Row 3,999                                                           │
└─────────────────────────────────────────────────────────────────────┘
                    1,000 rows in memory
                    Memory: ~500 KB
```

---

### **Virtualization (Only ~20 rows rendered)**

```
In-Memory Window (1,000 rows):
┌─────────────────────────────────────────────────────────────────────┐
│ Row 3,000                                                           │
│ Row 3,001                                                           │
│ ...                                                                 │
│ Row 3,494                                                           │
├═════════════════════════════════════════════════════════════════════┤ ← Viewport Top
│ Row 3,495  ◄─────────────────────────────────────────────┐         │
│ Row 3,496                                                 │         │
│ Row 3,497                                                 │         │
│ Row 3,498                                                 │         │
│ Row 3,499                                                 │         │
│ Row 3,500                                                 │         │
│ Row 3,501                                                 │         │
│ Row 3,502                                                 │         │
│ Row 3,503                                                 │         │
│ Row 3,504                                                 │         │
│ Row 3,505                                                 │         │
│ Row 3,506                                                 │         │
│ Row 3,507                                                 │         │
│ Row 3,508                                                 │         │
│ Row 3,509                                                 │         │
│ Row 3,510                                                 │         │
│ Row 3,511                                                 │         │
│ Row 3,512                                                 │         │
│ Row 3,513                                                 │         │
│ Row 3,514  ◄─────────────────────────────────────────────┘         │
├═════════════════════════════════════════════════════════════════════┤ ← Viewport Bottom
│ Row 3,515                                                           │
│ Row 3,516                                                           │
│ ...                                                                 │
│ Row 3,999                                                           │
└─────────────────────────────────────────────────────────────────────┘

                    ↓ Only this section rendered ↓

DOM (Rendered Rows):
┌─────────────────────────────────────────────────────────────────────┐
│ <div>Row 3,495</div>                                                │
│ <div>Row 3,496</div>                                                │
│ <div>Row 3,497</div>                                                │
│ <div>Row 3,498</div>                                                │
│ <div>Row 3,499</div>                                                │
│ <div>Row 3,500</div>                                                │
│ <div>Row 3,501</div>                                                │
│ <div>Row 3,502</div>                                                │
│ <div>Row 3,503</div>                                                │
│ <div>Row 3,504</div>                                                │
│ <div>Row 3,505</div>                                                │
│ <div>Row 3,506</div>                                                │
│ <div>Row 3,507</div>                                                │
│ <div>Row 3,508</div>                                                │
│ <div>Row 3,509</div>                                                │
│ <div>Row 3,510</div>                                                │
│ <div>Row 3,511</div>                                                │
│ <div>Row 3,512</div>                                                │
│ <div>Row 3,513</div>                                                │
│ <div>Row 3,514</div>                                                │
└─────────────────────────────────────────────────────────────────────┘
                    ~20 DOM nodes
                    Rendered in browser
```

---

## 🔄 **Window Sliding Animation**

### **Step 1: Initial State (windowOffset = 0)**
```
Full Dataset: [0 ─────────────────────────────────────────── 99,999]
Window:       [0 ──── 999]
              ↑
              windowOffset = 0
```

### **Step 2: User Scrolls Down (windowOffset = 0)**
```
Full Dataset: [0 ─────────────────────────────────────────── 99,999]
Window:       [0 ──────────── 1,199]  (1,200 rows - EXCEEDS MAX!)
              ↑
              windowOffset = 0
```

### **Step 3: Window Shifts (windowOffset = 200)**
```
Full Dataset: [0 ─────────────────────────────────────────── 99,999]
              [X X X X X X X X]  ← Removed from memory
Window:                   [200 ──── 1,199]  (1,000 rows)
                          ↑
                          windowOffset = 200
```

### **Step 4: User Continues Scrolling (windowOffset = 400)**
```
Full Dataset: [0 ─────────────────────────────────────────── 99,999]
              [X X X X X X X X X X X X X X X X]  ← Removed
Window:                           [400 ──── 1,399]  (1,000 rows)
                                  ↑
                                  windowOffset = 400
```

### **Step 5: User at Row 5,000 (windowOffset = 4,800)**
```
Full Dataset: [0 ─────────────────────────────────────────── 99,999]
              [X X X X X X X X X X X X X X X X X X X X X X X X]  ← Removed
Window:                                           [4,800 ──── 5,799]
                                                  ↑
                                                  windowOffset = 4,800
```

---

## 📊 **Memory Usage Comparison**

### **Without Sliding Window (BEFORE)**
```
User scrolls to row 5,000:

Memory Usage:
┌─────────────────────────────────────────────────────────────────────┐
│ Row 0      ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │
│ Row 1      ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │
│ Row 2      ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │
│ ...        ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │
│ Row 4,998  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │
│ Row 4,999  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │
└─────────────────────────────────────────────────────────────────────┘
Total: 5,000 rows in memory = ~2.5 MB
FPS: <10 ❌
```

### **With Sliding Window (AFTER)**
```
User scrolls to row 5,000:

Memory Usage:
┌─────────────────────────────────────────────────────────────────────┐
│ Row 0      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │ ← Not in memory
│ Row 1      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │ ← Not in memory
│ ...        ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │ ← Not in memory
│ Row 4,799  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │ ← Not in memory
│ Row 4,800  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │ ← In memory
│ Row 4,801  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │ ← In memory
│ ...        ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │ ← In memory
│ Row 5,798  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │ ← In memory
│ Row 5,799  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │ ← In memory
└─────────────────────────────────────────────────────────────────────┘
Total: 1,000 rows in memory = ~500 KB
FPS: 60 ✅
```

---

## 🎯 **Key Metrics**

### **Three Layers of Optimization**

```
┌─────────────────────────────────────────────────────────────────────┐
│                        FULL DATASET                                 │
│                        100,000 rows                                 │
│                        50 MB (if all in memory)                     │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
                    SLIDING WINDOW (Layer 1)
                              ↓
┌─────────────────────────────────────────────────────────────────────┐
│                      IN-MEMORY WINDOW                               │
│                      1,000 rows                                     │
│                      500 KB                                         │
│                      60,000 iterations/second                       │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
                    VIRTUALIZATION (Layer 2)
                              ↓
┌─────────────────────────────────────────────────────────────────────┐
│                      VISIBLE ROWS                                   │
│                      ~20 rows                                       │
│                      10 KB                                          │
│                      Rendered in DOM                                │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
                    BROWSER RENDERING (Layer 3)
                              ↓
┌─────────────────────────────────────────────────────────────────────┐
│                      USER SEES                                      │
│                      ~15 rows on screen                             │
│                      Smooth 60 FPS scrolling                        │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 📈 **Performance Impact**

```
WITHOUT SLIDING WINDOW:
┌────────────────────────────────────────────────────────────┐
│ Rows Loaded:  200   1k    4k    10k   100k                │
│ Memory:       ▓     ▓▓    ▓▓▓▓  ▓▓▓▓▓ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │
│ FPS:          60    45    <10   <5    Unusable            │
└────────────────────────────────────────────────────────────┘

WITH SLIDING WINDOW:
┌────────────────────────────────────────────────────────────┐
│ Rows Loaded:  200   1k    4k    10k   100k                │
│ Memory:       ▓     ▓▓    ▓▓    ▓▓    ▓▓                  │
│ FPS:          60    60    60    60    60                   │
└────────────────────────────────────────────────────────────┘
```

**Result:** Constant performance regardless of total rows accessed! 🎉

